// GPL v2
(function(){var n=/\s*[+-]\d*\.?\d+/,q=function(i,s){var r=Math.pow(10,parseInt(s)||0);return Math.round(i*r)/r},f=function(s,r,i){return Math.max(s,Math.min(r,i))},e=function(i){i._dec=parseInt(i._hex.substr(1),16)},l=function(i){var r=i._dec.toString(16);i._hex="#000000".substr(0,7-r.length)+r.toUpperCase()},d=function(i){i._rgb=[i._dec>>16,(i._dec>>8)&255,i._dec&255]},c=function(i){i._dec=i._rgb[0]<<16|(i._rgb[1]<<8)&65535|i._rgb[2]},m=function(u){var i=u._rgb[0]/255,x=u._rgb[1]/255,A=u._rgb[2]/255,v=Math.min(i,Math.min(x,A)),B=Math.max(i,Math.max(x,A)),y=B+v,z=B-v,t=y/2,C=t>0&&t<1?z/(t<0.5?y:(2-y)):0,w=z>0?B==i?(x-A)/z+(x<A?6:0):B==x?(A-i)/z+2:B==A?(i-x)/z+4:0:0;u._hsl=[q(w*60,2),q(C*100,2),q(t*100,2)]},b=function(s,r,i){i+=i<0?1:(i>1?-1:0);return q((i*6<1?s+(r-s)*i*6:i*2<1?r:i*3<2?s+(r-s)*(2/3-i)*6:s)*255,2)},p=function(r){var u=r._hsl[0]/360,t=r._hsl[1]/100,i=r._hsl[2]/100;if(t==0){i=q(i*255);r._rgb=[i,i,i]}else{var v=i<0.5?i*(1+t):i+t-i*t,w=2*i-v;r._rgb=[b(w,v,u+1/3),b(w,v,u),b(w,v,u-1/3)]}},k=function(s,i){if(i===undefined||i===null){return false}switch(s){case"rgb":return f(0,parseInt(i),255);case"h":return((parseFloat(i)%360)+360)%360;case"sl":return f(0,parseFloat(i),100);case"hex":var r=i.match(/#([0-9a-f]{6}|[0-9a-f]{3})/i);if(r){r=r[1].toUpperCase();if(r.length==3){r=r.replace(/([0-9A-F])/g,"$1$1")}return"#"+r}}return false},g=function(i,r){switch(r){case"rgb":c(i);l(i);m(i);break;case"hsl":p(i);c(i);l(i);break;case"hex":e(i);d(i);m(i);break}if(i._fn){i._fn.call(i)}},j=["red","green","blue"],o=["hue","saturation","lightness"],a=function(i,r){this._rgb=[0,0,0];this._hsl=[0,0,0];this._hex="#000000";this._dec=0;this._fn=r;this.hex(i)};a.prototype.rgb=function(s){if(s==undefined||s==null){return this._rgb}var u=k("rgb",s[0]),t=k("rgb",s[1]),i=k("rgb",s[2]);if(u===false||t===false||i===false){return this}if(this._rgb[0]!=u||this._rgb[1]!=t||this._rgb[2]!=i){this._rgb=[u,t,i];g(this,"rgb")}return this};a.prototype.hsl=function(r){if(r==undefined||r==null){return this._hsl}var u=k("h",r[0]),t=k("sl",r[1]),i=k("sl",r[2]);if(u===false||t===false||i===false){return this}if(this._hsl[0]!=u||this._hsl[1]!=t||this._hsl[2]!=i){this._hsl=[u,t,i];g(this,"hsl")}return this};a.prototype.hex=function(r){if(r==undefined||r==null){return this._hex}var i=k("hex",r);if(i&&this._hex!=i){this._hex=i;g(this,"hex")}return this};for(var h=0;h<3;h++){a.prototype[j[h]]=(function(r){return function(i){if(i===undefined||i===null){return this._rgb[r]}var s=i;if(typeof i=="string"&&i.match(n)){s=this._rgb[r]+parseInt(i)}s=k("rgb",s);if(s!==false&&s!=this._rgb[r]){this._rgb[r]=s;g(this,"rgb")}return this}})(h);a.prototype[o[h]]=(function(r){return function(i){if(i===undefined||i===null){return this._hsl[r]}var s=i;if(typeof i=="string"&&i.match(n)){s=this._hsl[r]+parseFloat(i)}s=k(r==0?"h":"sl",s);if(s!==false&&this._hsl[r]!=s){this._hsl[r]=s;g(this,"hsl")}return this}})(h)}a.prototype.fn=function(){if(this._fn){return this._fn.apply(this,arguments)}return this};a.prototype.toString=function(){return this._hex};window.kt_Color=a})();(function(h){var d='<div class="farbtastic"><div class="color"/><div class="wheel"/><div class="overlay"/><div class="h-marker marker"/><div class="sl-marker marker"/></div>',b=84,g=100,c=97,f=false,a=function(){var i=this.currentStyle.backgroundImage;if(i!="none"){h(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+i.substring(5,i.length-2)+"')"})}},e=function(k,w){var y=h(k).html(d),r=h(document),n=y.children(),v=n.children(".wheel"),o=n.children(".h-marker"),m=n.children(".sl-marker"),p=n.children(".color"),j=false,q=new kt_Color("#000000",function(){var z=this._hsl[0]*6.28/360;o.css({left:Math.round(Math.sin(z)*b)+c,top:Math.round(-Math.cos(z)*b)+c});m.css({left:c-Math.round(g*(this._hsl[1]/100-0.5)),top:c-Math.round(g*(this._hsl[2]/100-0.5))});p.css("backgroundColor",i.hue(q._hsl[0]).hex());if(w){w.call(this)}}),i=new kt_Color("#FF0000"),x=function(z){var A=v.offset();return{x:(z.pageX-A.left)-c,y:(z.pageY-A.top)-c}},l=function(z){if(z.which!=1){return false}if(!f){r.on(u);f=true}var A=x(z);j=Math.max(Math.abs(A.x),Math.abs(A.y))*2>g;t(z);return false},t=function(z){var A=x(z);q.hsl(j?[Math.atan2(A.x,-A.y)*360/6.28,q._hsl[1],q._hsl[2]]:[q._hsl[0],-100*(A.x/g)+50,-100*(A.y/g)+50])},s=function(){r.off(u);f=false},u={mousemove:t,mouseup:s};if(navigator.appVersion.match(/MSIE [0-6]\./)){n.children().each(a)}n.on("mousedown",l);return q};window.kt_Color_Picker=e})(jQuery);(function(b,a){b(function(){var u=b(document),r=b("#editor"),c=b("#colors"),t=b(a.replace(/%1\$s/g,"#000000").replace(/%2\$s/g,"").replace(/%3\$s/g,"x")),d=b("#picker"),j=$focus=b(),p=kt_Color_Picker(d,function(){if(j){var v=this.hex();j.siblings(".hex").val(v);j.children(".preview").css("backgroundColor",v)}}),h=function(w){var v=String(w).toUpperCase().match(/([0-9A-F]{6}|[0-9A-F]{3})/);if(v){if(v[1].length==3){return"#"+v[1].replace(/([0-9A-F])/g,"$1$1")}return"#"+v[1]}return false},q=function(){return d.attr("aria-hidden")=="true"},n=function(){d.attr("aria-hidden","true");u.off("mousedown",i)},i=function(v){if(!b(v.target).closest(j).length){n()}},o=function(v){if(v.which==1){if(q()){u.on("mousedown",i);j=b(this);d.attr("aria-hidden","false").position({of:j.parent(),at:"left bottom",my:"left top-1px"})}else{n()}}},k=function(){var w=b(this),v=h(w.val());if(v){w.val(v).parent().find(".preview").css("backgroundColor",v)}},s=function(v){if(b(v.target).is(".picker")){if(v.type=="focusin"){$focus=b(this).attr("aria-grabbed","true").on("keydown",g)}else{$focus.attr("aria-grabbed","false").off("keydown",g)}}},g=function(w){console.log(w.which);switch(w.which){case 13:$focus.children(".color").trigger("focus");return false;case 37:case 38:if($focus.prev().length){$focus=$focus.prev().trigger("focus");return false}break;case 33:if($focus.prev().length){$focus.after($focus.prev());return false}break;case 39:case 40:if($focus.next().length){$focus=$focus.next().trigger("focus");return false}break;case 34:if($focus.next().length){$focus.before($focus.next());return false}break;case 35:$focus.appendTo(c).trigger("focus");return false;case 36:$focus.prependTo(c).trigger("focus");return false;case 46:var v=$focus.next();if(!v.length){v=$focus.prev()}$focus.remove();v.trigger("focus");break;case 27:$focus.trigger("blur");break}},m=function(v){if(v.type=="focusin"){j=b(this).on("keydown",f);p.hex(j.siblings(".hex").val()).fn()}else{n();j.off("keydown",f)}},f=function(y){var v=y.ctrlKey||y.shiftKey||y.metaKey?5:2.5,w="+"+v,z="-"+v;switch(y.which){case 109:case 189:p.hue(z);return false;case 107:case 187:p.hue(w);return false;case 38:p.lightness(w);return false;case 40:p.lightness(z);return false;case 37:p.saturation(w);return false;case 39:p.saturation(z);return false;case 27:if(q()){j.parent().trigger("focus")}else{n()}return false}},e=function(x){if(x.type=="focusin"){var w=b(this);if(h(this.value)){w.data("lastValue",this.value)}var v=w.data("autoFill");if(v){clearTimeout(v);w.removeData("autoFill")}}else{if(!h(this.value)){var w=b(this);w.data("autoFill",setTimeout(function(){w.val(w.data("lastValue"))},5000))}}},l=function(v){if(v.which==27){b(this).parent().trigger("focus")}};b("#custom").on("change",function(){r.attr("aria-hidden",this.checked?"false":"true")});b("#add").on("click",function(v){t.clone().appendTo(c).trigger("focus");v.preventDefault()});c.on("click",".remove",function(v){b(this).parent().remove();v.preventDefault()}).on("click",".handle",function(){b(this).parent().trigger("focus")}).on("focus blur",".picker",s).on("click",".color",o).on("focus blur",".color",m).on("change",".hex",k).on("focus blur",".hex",e).on("keydown","input",l).sortable({placeholder:"picker-placeholder",items:".picker",distance:2,tolerance:"pointer",helper:"clone",opacity:0.65,start:function(){$focus.trigger("blur")},stop:function(w,v){v.item.trigger("focus")}})})})(jQuery,kt_TinyMCE_color_picker);